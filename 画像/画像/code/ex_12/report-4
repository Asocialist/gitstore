Script started on Thu Jan 26 20:12:18 2023
u20216187@gw[31]: cat ex_12_3[K4.c

#include<stdio.h>
#include<stdlib.h>
#include<math.h>

#define MAXLENGTH 100
unsigned char header[54];
unsigned char imgin[3][512][512];
unsigned char imgout[3][512][512];

double dtemp[3][512][512];
int itemp[3][512][512];

void convert(int n);
void get_data();
void rgb_to_ybr();
void processing();
void ybr_to_rgb();
void put_data();
int calculate(int a, int b);
int width, height, bite;

double rgb_con_ybr[3][3] = {
  { 0.2990, 0.5870, 0.1140},
  {-0.1687,-0.3313, 0.5000},
  { 0.5000,-0.4187,-0.0813}
};

double ybr_con_rgb[3][3] = {
  { 1.0000, 0.0000, 1.4020},
  { 1.0000,-0.3441,-0.7141},
  { 1.0000, 1.7720, 0.0000}
};

//char ybr_name[3][3] = { "Y", "Cb", "Cr"};

int main(){

   get_data();
  rgb_to_ybr();
  processing();
  ybr_to_rgb();
  put_data();

  return 0;
}

void get_data(){
  FILE *fp;
  
  char filename[MAXLENGTH];
  int i, c, x, y;
  int filesize, offset, bite_pixel;

  printf("ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ä¸‹ã•ã„:");
  scanf("%s", filename);

  fp = fopen(filename, "rb");

  if(fp == NULL){
    printf("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ–ãƒ³ã§ãã¾ã›ã‚“.\n");
    exit(1);
  }

  printf("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ–ãƒ³ã—ã¾ã—ãŸ.\n");

  for(i = 0; i < 54; i ++){
    c = fgetc(fp);
    header[i] = (unsigned char)c;
  }

  /*  //---------------------------------
  printf("\n<ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—>\n");
  printf("header[0]=");
  convert(header[0]);

  printf(" header[1]=");
  convert(header[1]);
  printf("\n");
  */
  //---------------------------------
  printf("\n<ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º>\n");
  /*printf("header[2]=");
  convert(header[2]);

  printf(" header[3]=");
  convert(header[3]);

  printf(" header[4]=");
  convert(header[4]);

  printf(" header[5]=");
  convert(header[5]);
*/
  filesize = calculate(5, 2);
  printf("\n%dãƒã‚¤ãƒˆ\n", filesize);
  /*//---------------------------------
  printf("\n<äºˆç´„é ˜åŸŸ>\n");
  printf("header[6]=");
  convert(header[6]);

  printf(" header[7]=");
  convert(header[7]);

  printf(" header[8]=");
  convert(header[8]);

  printf(" header[9]=");
  convert(header[9]);
  printf("\n");
  */
  //---------------------------------
  printf("\n<ã‚ªãƒ•ã‚»ãƒƒãƒˆ>\n");
  /*printf("header[10]=");
  convert(header[10]);

  printf(" header[11]=");
  convert(header[11]);

  printf(" header[12]=");
  convert(header[12]);

  printf(" header[13]=");
  convert(header[13]);*/

  offset = calculate(13, 10),
  printf("\n%dãƒã‚¤ãƒˆ\n", offset);
  /*//---------------------------------
  printf("\n<æƒ…å ±ãƒ™ãƒƒãƒ€ã‚µã‚¤ã‚º>\n");
  printf("header[14]=");
  convert(header[14]);

  printf(" header[15]=");
  convert(header[15]);

  printf(" header[16]=");
  convert(header[16]);

  printf(" header[17]=");
  convert(header[17]);
  printf("\n");
  */
  //---------------------------------
  printf("\n<ç”»åƒã®å¹…>\n");
  /*printf("header[18]=");
  convert(header[18]);

  printf(" header[19]=");
  convert(header[19]);

  printf(" header[20]=");
  convert(header[20]);

  printf(" header[21]=");
  convert(header[21]);*/

  width = calculate(21, 18);
  printf("\n%dç”»ç´ \n",width);
  //---------------------------------
  printf("\n<ç”»åƒã®é«˜ã•>\n");
  /*printf("header[22]=");
  convert(header[22]);

  printf(" header[23]=");
  convert(header[23]);

  printf(" header[24]=");
  convert(header[24]);

  printf(" header[25]=");
  convert(header[25]);*/

  height = calculate(25, 22);
  printf("\n%dãƒ©ã‚¤ãƒ³\n",height);
  /*//---------------------------------
  printf("\n<è‰²ãƒ—ãƒ¬ãƒ¼ãƒ³æ•°>\n");
  printf("header[26]=");
  convert(header[26]);

  printf(" header[27]=");
  convert(header[27]);
  printf("\n");*/
  //---------------------------------
  printf("\n<1ç”»ç´ å½“ãŸã‚Šã®ãƒ“ãƒƒãƒˆæ•°>\n");
  /*printf("header[28]=");
  convert(header[28]);

  printf(" header[29]=");
  convert(header[29]);*/

  bite_pixel = calculate(29, 28);
  printf("\n%dãƒ“ãƒƒãƒˆ\n",bite_pixel);
  /*//---------------------------------
  printf("\n<åœ§ç¸®æ–¹å¼>\n");
  printf("header[30]=");
  convert(header[30]);

  printf(" header[31]=");
  convert(header[31]);

  printf(" header[32]=");
  convert(header[32]);

  printf(" header[33]=");
  convert(header[33]);
  printf("\n");
  //---------------------------------
  printf("\n<ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º>\n");
  printf("header[34]=");
  convert(header[34]);

  printf(" header[35]=");
  convert(header[35]);

  printf(" header[36]=");
  convert(header[36]);

  printf(" header[37]=");
  convert(header[37]);
  printf("\n");
  //---------------------------------
  printf("\n<æ°´å¹³è§£åƒåº¦>\n");
  printf("header[38]=");
  convert(header[38]);

  printf(" header[39]=");
  convert(header[39]);

  printf(" header[40]=");
  convert(header[40]);

  printf(" header[41]=");
  convert(header[41]);
  printf("\n");
  //---------------------------------
  printf("\n<å‚ç›´è§£åƒåº¦>\n");
  printf("header[42]=");
  convert(header[42]);

  printf(" header[43]=");
  convert(header[43]);

  printf(" header[44]=");
  convert(header[44]);

  printf(" header[45]=");
  convert(header[45]);
  printf("\n");
  //---------------------------------
  printf("\n<è‰²æ•°>\n");
  printf("header[46]=");
  convert(header[46]);

  printf(" header[47]=");
  convert(header[47]);

  printf(" header[48]=");
  convert(header[48]);

  printf(" header[49]=");
  convert(header[49]);
  printf("\n");
  //---------------------------------
  printf("\n<é‡è¦ãªè‰²æ•°>\n");
  printf("header[50]=");
  convert(header[50]);

  printf(" header[51]=");
  convert(header[51]);

  printf(" header[52]=");
  convert(header[52]);

  printf(" header[53]=");
  convert(header[53]);
  printf("\n");
  */
  //---------------------------------
  printf("\n<æŒ¿å…¥ãƒ“ãƒƒãƒˆæ•°>\n");
  bite = (offset + width * height * (bite_pixel / 8)) % 4;
  printf("%dãƒã‚¤ãƒˆ\n",bite);
  
  for(y = height - 1; y >= 0; y--){
    for(x = 0; x < width; x++){
      for(i = 2; i >= 0; i--){
        c = fgetc(fp);
        imgin[i][x][y] = (unsigned char)c;
      }
    }
  }
  fclose(fp);
  printf("\n%s ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ.\n", filename);

}

void convert(int n){
  
  printf("%02x", n);

}

int calculate(int a, int b){
  int i;
  int value;
  value = header[a];
  for(i = a-1; i >= b; i--){
    value <<= 8;
    value += header[i];
  }
  return value;
}

void processing(){
  int j,i,x,y;
  double n;
  double avg[3][3]={{0.0,-1.0,0.0},
		       {-1.0,5.0,-1.0},
		       {0.0,-1.0,0.0}};
  double sum;

  printf("\n<ãƒ•ã‚£ãƒ«ã‚¿ä¿‚æ•°>\n");
  for(i=0;i<3;i++){
    for(j=0;j<3;j++){
      printf("%3.6f  ",avg[i][j]);
    }
    printf("\n");
  }

  for(y=0;y<height;y++){
    for(x=0;x<width;x++){

  if(x<=0 || x>=width || y<=0 || y>=height){
    imgout[0][x][y]=0;
  
  }else{
    sum=0.0;

    for(j=-1;j<=1;j++){
      for(i=-1;i<=1;i++){
	sum += (double)imgin[0][x+i][y+j]*avg[i+1][j+1];
      }
    }

    if(sum>=0.0){
      n=(int)(sum+0.5);
    }
    else{
      n=(int)(sum-0.5);
    }
   
    if(n>255){
      n=255;
    }
    else if(n<0){
      n=0;
    }

    imgout[0][x][y] = (unsigned char)n;
  }
  imgout[1][x][y] = 128;
  imgout[2][x][y] = 128;
    }
  }

  
  printf("å…¥åŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å‡ºåŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ.\n");
  }



 

void put_data(){
  FILE *fp;
  char filename1[MAXLENGTH];
  int i,x,y;

  printf("å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ä¸‹ã•ã„:");
  scanf("%s",filename1);

  fp = fopen(filename1,"w+");
  

  printf("%sã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ãŸ.\n", filename1);

  for (i = 0; i < 54; i++){
    fputc(header[i], fp);
  }
  

  for(y = height - 1; y >= 0; y--){
    for(x = 0; x < width; x++){
      for(i = 2;i >= 0; i--){
        fputc(imgout[i][x][y], fp);
      }
    }
  }

  for(i = 0; i < bite; i++){
    fputc('\0', fp);
  }

  fclose(fp);

  printf("%sã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ.\n", filename1);

}

void rgb_to_ybr(){
  int i, x, y, j;

  /*
  printf("\n<å…¥åŠ›RGBä¿¡å·(æ•´æ•°å€¤)>\n");

  if(height <= 16 || width <= 16){
    
    printf("\n<Rä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0;x < width; x++){
        printf("%02x ", imgin[0][x][y]);
      }
      printf("\n");
    }

    printf("\n<Gä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ",imgin[1][x][y]);
      }
      printf("\n");
    }

    printf("\n<Bä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ",imgin[2][x][y]);
      }
      printf("\n");
    }
  }else{
    printf("ç”»åƒã‚µã‚¤ã‚ºãŒå¤§ãã„ãŸã‚è¡¨ç¤ºã—ã¾ã›ã‚“.\n");
  }
  */
  for(y = 0; y < height; y++){
    for(x = 0; x < width; x++){
      for(i = 0; i < 3; i++){
        dtemp[i][x][y] = 0.0;
        for (j = 0; j < 3; j++)
          dtemp[i][x][y] += rgb_con_ybr[i][j] * (double)imgin[j][x][y];
      }
    }
  }

  for(y = 0; y < height; y++){
    for(x = 0; x < width; x++){
      for(i = 0; i < 3; i++){
        
        if(dtemp[i][x][y] > 0.0){
          itemp[i][x][y] = (int)(dtemp[i][x][y] + 0.5);
        }else{
          itemp[i][x][y] = (int)(dtemp[i][x][y] - 0.5);
        }

        if (i != 0){
          itemp[i][x][y] += 128;
        }

        if (itemp[i][x][y] > 255){
          itemp[i][x][y] = 255;
	}else if (itemp[i][x][y] < 0){
          itemp[i][x][y] = 0;
        }
	
        imgin[i][x][y] = (unsigned char)itemp[i][x][y];
      }
    }
  }
  
  /*
  printf("\n<å…¥åŠ›YCbCrä¿¡å·(æ•´æ•°å€¤)>\n");
  
  if(height <= 16 || width <= 16){
    
    printf("\n<Yä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ", imgin[0][x][y]);
      }
      printf("\n");
    }
    
    printf("\n<Cbä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ",imgin[1][x][y]);
      }
      printf("\n");
    }

    printf("\n<Crä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ",imgin[2][x][y]);
      }
      printf("\n");
    }
  }else{
    printf("ç”»åƒã‚µã‚¤ã‚ºãŒå¤§ãã„ãŸã‚è¡¨ç¤ºã—ã¾ã›ã‚“.\n");
  }
  */
}

void ybr_to_rgb(){
  int i, x, y, j;
  
  /*
  printf("\n<å…¥åŠ›YCbCrä¿¡å·(æ•´æ•°å€¤)>\n");
  
  if(height <= 16 || width <= 16){

    printf("\n<Yä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0;x < width; x++){
        printf("%02x ", imgin[0][x][y]);
      }
      printf("\n");
    }

    printf("\n<Cbä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ",imgin[1][x][y]);
      }
      printf("\n");
    }

    printf("\n<Crä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ",imgin[2][x][y]);
      }
      printf("\n");
    }
  }else{
    printf("ç”»åƒã‚µã‚¤ã‚ºãŒå¤§ãã„ãŸã‚è¡¨ç¤ºã—ã¾ã›ã‚“.\n");
  }
  */

  for(y = 0; y < height; y++){
    for(x = 0; x < width; x++){
      for(i = 0; i < 3; i++){
        dtemp[i][x][y] = 0.0;
        for (j = 0; j < 3; j++)
          if (j == 0)
            dtemp[i][x][y] += ybr_con_rgb[i][j] * (double)imgout[j][x][y];
          else
            dtemp[i][x][y] += ybr_con_rgb[i][j] * (double)(imgout[j][x][y] - 128);
      }
    }
  }
  

  for(y = 0; y < height; y++){
    for(x = 0; x < width; x++){
      for(i = 0; i < 3; i++){
        
        if(dtemp[i][x][y] > 0.0){
         itemp[i][x][y] = (int)(dtemp[i][x][y] + 0.5);
          
        }else {
          itemp[i][x][y] = (int)(dtemp[i][x][y] - 0.5);
       
        }

        if (itemp[i][x][y] > 255){
          itemp[i][x][y] = 255;
        }else if (itemp[i][x][y] < 0){
          itemp[i][x][y] = 0;
        }

        imgout[i][x][y] = (unsigned char)itemp[i][x][y];
      }
    }
  }

  /*
  printf("\n<å…¥åŠ›RGBä¿¡å·(æ•´æ•°å€¤)>\n");

  if(height <= 16 || width <= 16){
    
    printf("\n<Rä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ", imgout[0][x][y]);
      }
      printf("\n");
    }

    printf("\n<Gä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ",imgout[1][x][y]);
      }
      printf("\n");
    }

    printf("\n<Bä¿¡å·>\n");
    for(y = 0; y < height; y++){
      for(x = 0; x < width; x++){
        printf("%02x ",imgout[2][x][y]);
      }
      printf("\n");
    }
  }else{
    printf("ç”»åƒã‚µã‚¤ã‚ºãŒå¤§ãã„ãŸã‚è¡¨ç¤ºã—ã¾ã›ã‚“.\n");
  }
  */
}
u20216187@gw[32]: gcc -Wall ex_12_4.c -o ex_12_4
u20216187@gw[33]: ./ex_12_4
ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ä¸‹ã•ã„:goldhill.bmp
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒ–ãƒ³ã—ã¾ã—ãŸ.

<ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º>

786488ãƒã‚¤ãƒˆ

<ã‚ªãƒ•ã‚»ãƒƒãƒˆ>

54ãƒã‚¤ãƒˆ

<ç”»åƒã®å¹…>

512ç”»ç´ 

<ç”»åƒã®é«˜ã•>

512ãƒ©ã‚¤ãƒ³

<1ç”»ç´ å½“ãŸã‚Šã®ãƒ“ãƒƒãƒˆæ•°>

24ãƒ“ãƒƒãƒˆ

<æŒ¿å…¥ãƒ“ãƒƒãƒˆæ•°>
2ãƒã‚¤ãƒˆ

goldhill.bmp ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ.

<ãƒ•ã‚£ãƒ«ã‚¿ä¿‚æ•°>
0.000000  -1.000000  0.000000  
-1.000000  5.000000  -1.000000  
0.000000  -1.000000  0.000000  
å…¥åŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å‡ºåŠ›ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ.
å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ä¸‹ã•ã„:goldhill_12_B_3.bmp
goldhill_12_B_3.bmpã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ãŸ.
goldhill_12_B_3.bmpã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ.
u20216187@gw[34]: exit
exit

Script done on Thu Jan 26 20:12:53 2023
